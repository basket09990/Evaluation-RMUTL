<!DOCTYPE html>
{% load static %}
<html>
    <head>
        <meta charset="UTF-8">

        <title>แบบประเมินผลการปฏิบัติงาน</title>
        <style>
            @font-face {
                font-family: 'Sarabun';
                src: url('static/fonts/THSarabunNew.ttf') format('truetype');
            }
            body {
                font-family: 'Sarabun', sans-serif;
                font-size: 16px;
            }
    
            table {
                width: 100%;
                border-collapse: collapse;
            }
    
            table, th, td {
                border: 1px solid black;
            }
    
            th, td {
                padding: 5px;
                text-align: left;
            }
        </style>
    </head>
    <body>
        {% csrf_token %}
        
        <h1>ข้อตกลงและแบบประเมินผลการปฏิบัติงานของบุคลากรสายวิชาการ SARAFASWFASFSDAFSEDR</h1>
        <h1>มหาวิทยาลัยเทคโนโลยีราชมงคลล้านนา ประจำปีงบประมาณ {{ user_evaluation_agreement_year_thai}}</h1>
                    
                      
                        
                        <div>
                            <h1>หน่วยงาน  คณะวิศวกรรมศาสตร์  มหาวิทยาลัยเทคโนโลยีราชมงคลล้านนา</h1>
                        </div>

                        <div >
                            <h4>กลุ่มที่เลือก:   {{ selected_group.g_field_name }}</h4>
                        </div>

                        <div>
                                {% if evr_round.evr_round == 1 %}
                                    <h4>ช่วงเวลา: ครั้งที่ 1 (1 ตุลาคม - 31 มีนาคม)</h4>
                                {% elif evr_round.evr_round == 2 %}
                                    <h4>ช่วงเวลา: ครั้งที่ 2 (1 เมษายน - 30 กันยายน)</h4>
                                {% else %}
                                    <p>ยังไม่มีข้อมูลรอบการประเมิน</p>
                                {% endif %}
                        </div>

                        <div >
                                <table class="form-table">
                                    <tr>
                                        <td>{{ profile_form.first_name.label_tag }}</td>
                                        <td>{{ profile_form.first_name }} {{ profile_form.first_name.errors }}</td>
                                        <td>{{ profile_form.last_name.label_tag }}</td>
                                        <td>{{ profile_form.last_name }} {{ profile_form.last_name.errors }}</td>
                                    </tr>
                                    <tr>
                                        <td>ในกรณีที่ไม่มีตำแหน่งบริหารให้ใช้เครื่องหมาย (-)</td>
                                        <td style="text-align: center; font-size:35px;"> - </td>
                                        <td>{{ extended_form.ac_id.label_tag }}</td>
                                        <td>{{ extended_form.ac_id }} {{ extended_form.ac_id.errors }}</td>
                                    </tr>
                                    <tr>
                                        <td>{{ extended_form.administrative_position.label_tag }}</td>
                                        <td>{{ extended_form.administrative_position }} {{ extended_form.administrative_position.errors }}</td>
                                        <td>{{ extended_form.salary.label_tag }}</td>
                                        <td>{{ extended_form.salary }} {{ extended_form.salary.errors }}</td>
                                    </tr>
                                    <tr>
                                        <td>{{ extended_form.position_number.label_tag }}</td>
                                        <td>{{ extended_form.position_number }} {{ extended_form.position_number.errors }}</td>
                                        <td>{{ extended_form.affiliation.label_tag }}</td>
                                        <td>{{ extended_form.affiliation }} {{ extended_form.affiliation.errors }}</td>
                                    </tr>
                                    <tr>
                                        <td>{{ extended_form.old_government.label_tag }}</td>
                                        <td>{{ extended_form.old_government }} {{ extended_form.old_government.errors }}</td>
                                        <td>{{ extended_form.special_position.label_tag }}</td>
                                        <td>{{ extended_form.special_position }} {{ extended_form.special_position.errors }}</td>
                                    </tr>
                                    <tr>
                                        <td>{{ extended_form.start_goverment.label_tag }}</td>
                                        <td>{{ extended_form.start_goverment }} {{ extended_form.start_goverment.errors }}</td>
                                        <td>
                                            รวมเวลารับราชการ:
                                        </td>
                                        <td>
                                            {{ profile.years_of_service }} ปี  {{ profile.months_of_service }} เดือน  {{ profile.days_of_service }} วัน
                                        </td>
                                    </tr>
                                </table>
                        </div>

                        {% if evr_round.evr_round == 1 %}
                
                        <div class="form-table">
                            <table class="form-table3">
                                <h4>บันทึกการปฏิบัติงาน</h4>
                                <thead>
                                    <tr>
                                        <th rowspan="2" class="text-center">ประเภทการลา</th>
                                        <th colspan="2" class="text-center">รอบที่ 1</th>
                                        <th colspan="2" class="text-center">รอบที่ 2</th>
                                    </tr>
                                    <tr>
                                        <th class="text-center">(จำนวนครั้ง)</th>
                                        <th class="text-center">(จำนวนวัน)</th>
                                        <th class="text-center">(จำนวนครั้ง)</th>
                                        <th class="text-center">(จำนวนวัน)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>ลาป่วย</td>
                                        <td>{{ sick_leave_form.times }}</td>
                                        <td>{{ sick_leave_form.days }}</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>ลากิจ</td>
                                        <td>{{ personal_leave_form.times }}</td>
                                        <td>{{ personal_leave_form.days }}</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>มาสาย</td>
                                        <td>{{ late_form.times }}</td>
                                        <td>{{ late_form.days }}</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>ลาคลอดบุตร</td>
                                        <td>{{ maternity_leave_form.times }}</td>
                                        <td>{{ maternity_leave_form.days }}</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>ลาอุปสมบท</td>
                                        <td>{{ ordination_leave_form.times }}</td>
                                        <td>{{ ordination_leave_form.days }}</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>ลาป่วยจำเป็นต้องรักษาตัวเป็นเวลานานคราวเดียวหรือหลายคราวรวมกัน</td>
                                        <td>{{ longsick_leave_form.times }}</td>
                                        <td>{{ longsick_leave_form.days }}</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>ขาดราชการ</td>
                                        <td>{{ adsent_work_form.times }}</td>
                                        <td>{{ adsent_work_form.days }}</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        {% elif evr_round.evr_round == 2 %}
                        <div class="form-table">
                            <table class="form-table3">
                                <h4>บันทึกการปฏิบัติงาน</h4>
                                <thead>
                                    <tr>
                                        <th rowspan="2" class="text-center">ประเภทการลา</th>
                                        <th colspan="2" class="text-center">รอบที่ 1</th>
                                        <th colspan="2" class="text-center">รอบที่ 2</th>
                                    </tr>
                                    <tr>
                                        <th class="text-center">(จำนวนครั้ง)</th>
                                        <th class="text-center">(จำนวนวัน)</th>
                                        <th class="text-center">(จำนวนครั้ง)</th>
                                        <th class="text-center">(จำนวนวัน)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>ลาป่วย</td>
                                        <td>{{ sick_leave_round_1_form.times }}</td>
                                        <td>{{ sick_leave_round_1_form.days }}</td>
                                        <td>{{ sick_leave_form.times }}</td>
                                        <td>{{ sick_leave_form.days }}</td>
                                    </tr>
                                    <tr>
                                        <td>ลากิจ</td>
                                        <td>{{ personal_leave_round_1_form.times }}</td>
                                        <td>{{ personal_leave_round_1_form.days }}</td>
                                        <td>{{ personal_leave_form.times }}</td>
                                        <td>{{ personal_leave_form.days }}</td>
                                    </tr>
                                    <tr>
                                        <td>มาสาย</td>
                                        <td>{{ late_round_1_form.times }}</td>
                                        <td>{{ late_round_1_form.days }}</td>
                                        <td>{{ late_form.times }}</td>
                                        <td>{{ late_form.days }}</td>
                                    </tr>
                                    <tr>
                                        <td>ลาคลอดบุตร</td>
                                        <td>{{ maternity_leave_round_1_form.times }}</td>
                                        <td>{{ maternity_leave_round_1_form.days }}</td>
                                        <td>{{ maternity_leave_form.times }}</td>
                                        <td>{{ maternity_leave_form.days }}</td>
                                    </tr>
                                    <tr>
                                        <td>ลาอุปสมบท</td>
                                        <td>{{ ordination_leave_round_1_form.times }}</td>
                                        <td>{{ ordination_leave_round_1_form.days }}</td>
                                        <td>{{ ordination_leave_form.times }}</td>
                                        <td>{{ ordination_leave_form.days }}</td>
                                    </tr>
                                    <tr>
                                        <td>ลาป่วยจำเป็นต้องรักษาตัวเป็นเวลานานคราวเดียวหรือหลายคราวรวมกัน</td>
                                        <td>{{ longsick_leave_round_1_form.times }}</td>
                                        <td>{{ longsick_leave_round_1_form.days }}</td>
                                        <td>{{ longsick_leave_form.times }}</td>
                                        <td>{{ longsick_leave_form.days }}</td>
                                    </tr>
                                    <tr>
                                        <td>ขาดราชการ</td>
                                        <td>{{ adsent_work_round_1_form.times }}</td>
                                        <td>{{ adsent_work_round_1_form.days }}</td>
                                        <td>{{ adsent_work_form.times }}</td>
                                        <td>{{ adsent_work_form.days }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        {% endif %}
                        <div>
                            {{ work_form_current.as_p }}
                        </div>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                            <thead>
                                <tr>
                                    <th style="text-align: left;"><h3>ส่วนที่  1  องค์ประกอบที่ 1 ผลสัมฤทธิ์ของงาน</h3></th>
                                    
                                </tr>
                                <tr>
                                    <th style="padding: 10px; border: 1px solid #ddd; background-color: #f0f0f0; font-weight: bold; color: #333;">ภาระงาน/กิจกรรม/โครงการ/งาน</th>
                                    <th style="padding: 10px; border: 1px solid #ddd; background-color: #f0f0f0; font-weight: bold; color: #333;">จำนวน</th>
                                    <th style="padding: 10px; border: 1px solid #ddd; background-color: #f0f0f0; font-weight: bold; color: #333;">ภาระงาน</th>
                                    <th style="padding: 10px; border: 1px solid #ddd; background-color: #f0f0f0; font-weight: bold; color: #333;">รวมภาระงาน</th>
                                    <th style="padding: 10px; border: 1px solid #ddd; background-color: #f0f0f0; font-weight: bold; color: #333;">หมายเหตุ</th>
                                    
                                </tr>
                            </thead>
                            <tbody>
                                <script>
                                    let fieldCounter = 0;  // ตัวนับ field
                                    let subfieldCounter = 0;  // ตัวนับ subfield
                                    let selectionCounter = 0;  // ตัวนับ selection
                                </script>
                            
                                {% for field in fields %}
                                    <tr class="field-row" data-field-id="{{ field.f_id }}">
                                        <td style="padding: 10px; border: 1px solid #ddd;">
                                            <script>document.write(++fieldCounter);</script>. {{ field.f_name }}
                                        </td>
                                        <td style="padding: 10px; border: 1px solid #ddd;"></td>
                                        <td style="padding: 10px; border: 1px solid #ddd;"></td>
                                        <td style="padding: 10px; border: 1px solid #ddd;"></td>
                                        <td style="padding: 10px; border: 1px solid #ddd;"></td>
                                    </tr>
                            
                                    <script>subfieldCounter = 0;</script>
                                    {% for subfield in subfields %}
                                        {% if subfield.f_id == field %}
                                            <tr class="subfield-row" data-field-id="{{ field.f_id }}">
                                                <td style="padding: 10px; border: 1px solid #ddd;">
                                                    <script>document.write(fieldCounter + '.' + (++subfieldCounter));</script>. {{ subfield.sf_name }}
                                                </td>
                                                <td style="padding: 10px; border: 1px solid #ddd;"></td>
                                                <td style="padding: 10px; border: 1px solid #ddd;"></td>
                                                <td style="padding: 10px; border: 1px solid #ddd;"></td>
                                                <td style="padding: 10px; border: 1px solid #ddd;"></td>
                                            </tr>
                            
                                            <script>selectionCounter = 0;</script>
                                            {% for selection in workload_selections %}
                                            {% if selection.sf_id == subfield %}
                                                <tr class="selection-row" data-field-id="{{ field.f_id }}" data-calculated-workload="{{ selection.calculated_workload }}">
                                                    <td style="padding: 10px; border: 1px solid #ddd;">
                                                        <script>document.write(fieldCounter + '.' + subfieldCounter + '.' + (++selectionCounter));</script>. {{ selection.selected_name }}
                                                    </td>
                                                    <td style="text-align: center; padding: 10px; border: 1px solid #ddd;">{{ selection.selected_num }}</td>
                                                    <td style="text-align: center; padding: 10px; border: 1px solid #ddd;">{{ selection.selected_workload }}</td>
                                                    <td style="text-align: center; padding: 10px; border: 1px solid #ddd;">{{ selection.calculated_workload|floatformat:1 }}</td>
                                                    <td style="text-align: center; padding: 10px; border: 1px solid #ddd;">{{ selection.notes }}</td>
                                                    <td><a href="{% url 'upload_evidence' selection.id %}" class="btn btn-primary btn-small">หลักฐาน</a></td>
                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                    
                                    <!-- เพิ่มแถวแสดงผลรวมสำหรับแต่ละ field -->
                                    <tr class="field-total-row" data-field-id="{{ field.f_id }}">
                                        <td colspan="3" style="text-align: right; font-weight: bold; padding: 10px; border: 1px solid #ddd;">
                                            รวมคะแนนสำหรับ {{ field.f_name }}:
                                        </td>
                                        <td class="field-total" style="text-align: center; font-weight: bold; padding: 10px; border: 1px solid #ddd;">
                                            0.00
                                        </td>
                                        <td style="padding: 10px; border: 1px solid #ddd;"></td>
                                    </tr>
                                {% endfor %}
                                
                                <!-- แถวสำหรับแสดงผลรวมของคะแนนทั้งหมด -->
                                <tr class="overall-total-row">
                                    <td colspan="3" style="text-align: right; font-weight: bold; padding: 10px; border: 1px solid #ddd;">
                                        คะแนนรวมทั้งหมด:
                                    </td>
                                    <td id="overall-total" style="text-align: center; font-weight: bold; padding: 10px; border: 1px solid #ddd;">
                                        0.00
                                    </td>
                                    <td style="padding: 10px; border: 1px solid #ddd;"></td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <!-- แสดงผลรวมที่ท้ายตาราง -->
                        <div class="total-workload">
                            <h2>คะแนนภาระงานต้องไม่น้อยกว่า {{min_workload}} ภาระงาน</h2>
                            <h2><strong>ผลรวมของคะแนนภาระงาน:</strong> {{ total_workload|floatformat:1 }}</h2>
                            
                            <h2><strong>คะแนนผลสัมฤทธิ์ของงาน:</strong> {{ achievement_work|floatformat:1 }}</h2>
                        </div>
                    
                        <div>
                                {% csrf_token %}
                                <h1>ส่วนที่  2 องค์ประกอบที่ 2 พฤติกรรมการปฏิบัติงาน (สมรรถนะ)</h1>
                            
                                <h3><strong>ระดับตำแหน่งผู้รับการประเมิน:</strong> {{ profile.ac_id.ac_name }}</h3>
                            
                                    <!-- Main Competencies -->
                                <table class="form-table">
                                    <thead>
                                        <tr>
                                            <th>สมรรถนะหลัก (ที่สภามหาวิทยาลัยกำหนด)</th>
                                            <th>ระดับสมรรถนะที่คาดหวัง</th>
                                            <th>ระดับสมรรถนะที่แสดงออก</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for competency in main_competencies %}
                                        <tr>
                                            <td>{{ competency.mc_name }}</td>
                                            <td style="text-align: center;">{{ competency.mc_num }}</td>
                                            <td style="text-align: center;">
                                                <input type="number" name="main_actual_score_{{ competency.mc_id }}" 
                                                       value="{% for score in main_scores %}{% if score.mc_id_id == competency.mc_id %}{{ score.actual_score }}{% endif %}{% endfor %}" 
                                                       style="text-align: center;"/>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            
                                <!-- Specific Competencies -->
                                <table class="form-table" style="margin-top: 50px;">
                                    <thead>
                                        <tr>
                                            <th>สมรรถนะเฉพาะ (ที่สภามหาวิทยาลัยกำหนด)</th>
                                            <th>ระดับสมรรถนะที่คาดหวัง</th>
                                            <th>ระดับสมรรถนะที่แสดงออก</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for competency in specific_competencies %}
                                        <tr>
                                            <td>{{ competency.sc_name }}</td>
                                            <td style="text-align: center;">{{ competency.sc_num }}</td>
                                            <td style="text-align: center;">
                                                <input type="number" name="specific_actual_score_{{ competency.sc_id }}" 
                                                       value="{% for score in specific_scores %}{% if score.sc_id_id == competency.sc_id %}{{ score.actual_score }}{% endif %}{% endfor %}" 
                                                       style="text-align: center;"/>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            
                                <!-- Administrative Competencies -->
                                {% if administrative_competencies %}
                                <table class="form-table" style="margin-top: 50px;">
                                    <h3><strong>ตำแหน่งบริหาร {{ profile.administrative_position }}</strong></h3>
                                    <thead>
                                        <tr>
                                            <th>สมรรถนะทางการบริหาร (ที่สภามหาวิทยาลัยกำหนด)</th>
                                            <th>ระดับสมรรถนะที่คาดหวัง</th>
                                            <th>ระดับสมรรถนะที่แสดงออก</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for competency in administrative_competencies %}
                                        <tr>
                                            <td>{{ competency.adc_name }}</td>
                                            <td style="text-align: center;">
                                                <input type="number" name="admin_uceo_num_{{ competency.adc_id }}" 
                                                        value="{% for score in administrative_scores %}{% if score.adc_id_id == competency.adc_id %}{{ score.uceo_num }}{% endif %}{% endfor %}" style="text-align: center;" />
                                                </td>
                                            <td style="text-align: center;">
                                                <input type="number" name="admin_actual_score_{{ competency.adc_id }}" 
                                                       value="{% for score in administrative_scores %}{% if score.adc_id_id == competency.adc_id %}{{ score.actual_score }}{% endif %}{% endfor %}" style="text-align: center;"/>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                                {% endif %}
                            
                                    <!-- สรุปผลรวมของคะแนน -->
                                
                                    <table class="form-table" style="margin-top: 50px;">
                                        <thead>
                                            <tr>
                                                <th colspan="3">การประเมิน</th>
                                            </tr>
                                            <tr>
                                                <th>จำนวนสมรรถนะ</th>
                                                <th>คูณ (X)</th>
                                                <th>คะแนน</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td style="text-align: center;">{{ count_3 }}</td>
                                                <td style="text-align: center;">3</td>
                                                <td style="text-align: center;">{{ score_3_total }}</td>
                                            </tr>
                                            <tr>
                                                <td style="text-align: center;">{{ count_2 }}</td>
                                                <td style="text-align: center;">2</td>
                                                <td style="text-align: center;">{{ score_2_total }}</td>
                                            </tr>
                                            <tr>
                                                <td style="text-align: center;">{{ count_1 }}</td>
                                                <td style="text-align: center;">1</td>
                                                <td style="text-align: center;">{{ score_1_total }}</td>
                                            </tr>
                                            <tr>
                                                <td style="text-align: center;">{{ count_0 }}</td>
                                                <td style="text-align: center;">0</td>
                                                <td style="text-align: center;">{{ score_0_total }}</td>
                                            </tr>
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <th colspan="2">ผลรวมคะแนน</th>
                                                <th>{{ total_score }}</th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                    </table>
                                    <h2>( ผลรวมคะแนน {{total_score}} / ผลรวมระดับสมรรถนะที่คาดหวัง {{total_max_num}} ) * 30 คะแนนที่ได้ : {{ calculated_score|floatformat:2 }}</h2>
                            
                                <table class="form-table">
                                    <tr>
                                    <td>หลักเกณฑ์การประเมิน </td>
                                    </tr>
                                    <tr>
                                    <td>จำนวนสมรรถนะหลัก/สมรรถนะเฉพาะ/สมรรถนะทางการบริหาร ที่มีระดับสมรรถนะที่แสดงออก สูงกว่าหรือเท่ากับ ระดับสมรรถนะที่คาดหวัง x ๓ คะแนน </td>
                                    </tr>
                                    <tr>
                                    <td>จำนวนสมรรถนะหลัก/สมรรถนะเฉพาะ/สมรรถนะทางการบริหาร ที่มีระดับสมรรถนะที่แสดงออก ต่ำกว่า ระดับสมรรถนะที่คาดหวัง ๑ ระดับ x ๒ คะแนน </td>
                                    </tr>
                                    <tr>   
                                    <td>จำนวนสมรรถนะหลัก/สมรรถนะเฉพาะ/สมรรถนะทางการบริหาร ที่มีระดับสมรรถนะที่แสดงออก ต่ำกว่า ระดับสมรรถนะที่คาดหวัง ๒ ระดับ x ๑ คะแนน </td>
                                    </tr>
                                    <tr>
                                    <td>จำนวนสมรรถนะหลัก/สมรรถนะเฉพาะ/สมรรถนะทางการบริหาร ที่มีระดับสมรรถนะที่แสดงออก ต่ำกว่า ระดับสมรรถนะที่คาดหวัง ๓ ระดับ x ๐ คะแนน </td>
                                    </tr>
                                </table>
                        
                            </div>


                            <div>
                               
                            
                                   
                                        <h2>ส่วนที่ 3 สรุปการประเมินผลการปฏิบัติราชการ</h2>
                                        
                                        <table class="form-table">
                                            <tr>
                                                <th>องค์ประกอบการประเมิน</th>
                                                <th>คะแนนเต็ม</th>
                                                <th>คะแนนที่ได้</th>
                                                <th>หมายเหตุ</th>
                                            </tr>
                                            <tr>
                                                <td>องค์ประกอบที่ 1: ผลสัมฤทธิ์ของงาน</td>
                                                <td style="text-align: center;">70</td>
                                                <td style="text-align: center;">{{ achievement_work|floatformat:1  }}</td>
                                                <td style="text-align: center;">
                                                    <textarea name="remark_achievement" rows="2" cols="20">{{ remark_achievement|default_if_none:'' }}</textarea>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>องค์ประกอบที่ 2: พฤติกรรมการปฏิบัติราชการ (สมรรถนะ)</td>
                                                <td style="text-align: center;">30</td>
                                                <td style="text-align: center;">{{ mc_score|floatformat:1  }}</td>
                                                <td>
                                                    <textarea name="remark_mc" rows="2" cols="20">{{ remark_mc|default_if_none:'' }}</textarea>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>องค์ประกอบอื่น ๆ (ถ้ามี)</td>
                                                <td style="text-align: center;"></td>
                                                <td style="text-align: center;"></td>
                                                <td style="text-align: center;">
                                                    <textarea name="remark_other" rows="2" cols="20">{{ remark_other|default_if_none:'' }}</textarea>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>รวม</td>
                                                <td style="text-align: center;">100</td>
                                                <td style="text-align: center;">{{ total_score|floatformat:1  }}</td>
                                                <td style="text-align: center;">
                                                    <textarea name="remark_total" rows="2" cols="20">{{ remark_total|default_if_none:'' }}</textarea>
                                                </td>
                                            </tr>
                                        </table>
                                    
                                        <h3>ระดับผลการประเมิน</h3>
                                        <fieldset>
                                            <legend>ระดับผลการประเมิน</legend>
                                            <div>
                                                <input type="radio" name="evaluation_level" value="ดีเด่น" {% if total_score >= 90 %}checked{% endif %}>
                                                <label>ดีเด่น (90 - 100)</label>
                                            </div>
                                            <div>
                                                <input type="radio" name="evaluation_level" value="ดีมาก" {% if total_score >= 80 and total_score < 90 %}checked{% endif %}>
                                                <label>ดีมาก (80 - 89.99)</label>
                                            </div>
                                            <div>
                                                <input type="radio" name="evaluation_level" value="ดี" {% if total_score >= 70 and total_score < 80 %}checked{% endif %}>
                                                <label>ดี (70 - 79.99)</label>
                                            </div>
                                            <div>
                                                <input type="radio" name="evaluation_level" value="พอใช้" {% if total_score >= 60 and total_score < 70 %}checked{% endif %}>
                                                <label>พอใช้ (60 - 69.99)</label>
                                            </div>
                                            <div>
                                                <input type="radio" name="evaluation_level" value="ต้องปรับปรุง" {% if total_score < 60 %}checked{% endif %}>
                                                <label>ต้องปรับปรุง (ต่ำกว่า 60)</label>
                                            </div>
                                        </fieldset>
                                
                            </div>


                            <div>
                              
                                   
                                    <h2>ส่วนที่ 4 : แผนพัฒนาการปฏิบัติราชการรายบุคคล</h2>
                                
                                    <!-- Formset for PersonalDiagram -->
                                    <table class="form-table">
                                        <thead>
                                            <tr>
                                                <th>ความรู้/ทักษะ/สมรรถนะที่ต้องได้รับการพัฒนา</th>
                                                <th>วิธีการพัฒนา</th>
                                                <th>ช่วงเวลาที่ต้องการพัฒนา</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for pd in formset %}
                                                <tr>
                                                    <td>{{ pd.skill_evol }}</td>
                                                    <td>{{ pd.dev }}</td>
                                                    <td style="display: flex; align-items: center;">
                                                        {{ pd.dev_time }}
                                                        <a href="{% url 'edit_personal_diagram' pd.instance.pk %}" class="btn btn-primary btn-sm" style="margin-left: 5px; padding: 3px 8px; font-size: 12px;">แก้ไข</a>
                                                        <form action="{% url 'delete_personal_diagram' pd.instance.pk %}" method="post" style="display:inline; margin-left: 5px;">
                                                            {% csrf_token %}
                                                            <button type="submit" class="btn btn-danger btn-sm" style="padding: 3px 8px; font-size: 12px;" onclick="return confirm('คุณแน่ใจหรือไม่ว่าต้องการลบรายการนี้?');">ลบ</button>
                                                        </form>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                
                                    <!-- Add new PersonalDiagram Button -->
                                    <div style="margin-top: 10px;">
                                        <a href="{% url 'add_personal_diagram' evaluation_id=evaluation_id %}" class="btn btn-primary btn-sm">เพิ่มข้อมูล</a>
                                    </div>
                                
                                    <!-- UserEvaluationForm Fields -->
                                    <table class="form-table" style="margin-top: 20px;">
                                        <thead>
                                            <tr>
                                                <th>ความเห็นเพิ่มเติมของผู้ประเมิน</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <label for="improved" style="text-align: left;">1) จุดเด่น และ/หรือ สิ่งที่ควรปรับปรุงแก้ไข</label><br>
                                                    {{ form.improved }}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <label for="suggestions" style="text-align: left;">2) ข้อเสนอแนะเกี่ยวกับวิธีส่งเสริมและพัฒนา</label><br>
                                                    {{ form.suggestions }}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                
                                  
                               
                            
                                <table class="form-table">
                                    <tr>
                                        <td colspan="2" style="text-align: center;">
                                            ผู้ประเมินและผู้รับการประเมินได้ตกลงร่วมกันและเห็นพ้องกันแล้ว (ระบุข้อมูลให้ครบ)
                                            <div style="text-align: center;">
                                            จึงลงลายมือชื่อไว้เป็นหลักฐาน (ลงนามเมื่อจัดทำข้อตกลง)
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: center; padding-top:10px;">
                                            ลายมือชื่อ.................................................(ผู้ประเมิน)
                                            <div class="date-container" style="text-align: center;">
                                                วันที่..........เดือน...................พ.ศ. ............
                                            </div>
                                        </td>
                                        <td style="text-align: center; padding-top:10px;">
                                            ลายมือชื่อ.................................................(ผู้รับการประเมิน)
                                            <div class="date-container" style="text-align: center;" padding-top:10px;>
                                                วันที่..........เดือน...................พ.ศ. ............
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>


                            <div>
                                <div>
                                    <h2>ส่วนที่ 5 การรับทราบผลการประเมิน</h2>
                                    <table class="form-table">
                                        <tr>
                                            <td colspan="2"><strong>ผู้รับการประเมิน :</strong></td>
                                        </tr>
                                        <tr>
                                            <td rowspan ="3"><div style=" solid black; padding: 10px; display: inline-block;">
                                                <label>
                                                    <input type="checkbox" name="example_checkbox">
                                                </label>
                                            </div>ได้รับทราบผลการประเมินและแผนพัฒนา<div style=" padding-left: 35px; ">
                                            การปฏิบัติราชการรายบุคคลแล้ว</div></td>
                                            <td style="padding-top:30px;">ลงชื่อ..........................................................</td>
                                        </tr>
                                        <tr>
                                            
                                            <td style="padding-top:30px;">ตำแหน่ง.....................................................</td>
                                        </tr>
                                        <tr>
                                            
                                            <td style="padding-top:30px;">วันที่...........................................................</td>
                                        </tr>
                                        <tr>
                                            <td colspan="2"><strong>ผู้ประเมิน :</strong></td>
                                        </tr>
                                        <tr>
                                            <td rowspan ="2"><div style=" solid black; padding: 10px; display: inline-block;">
                                                <label>
                                                    <input type="checkbox" name="example_checkbox">
                                                </label>
                                            </div>ได้แจ้งผลการประเมินและผู้รับการประเมิน
                                        <div style=" padding-left: 35px; ">ได้ลงนามรับทราบ
                                        </div>
                                        </td>
                                            <td style="padding-top:30px;">ลงชื่อ..........................................................</td>
                                        </tr>
                                        <tr>
                                            <td style="padding-top:30px;">ตำแหน่ง...................................................</td>
                                        </tr>
                                        <tr>
                                            <td ><div style=" solid black; padding: 10px; display: inline-block;">
                                                <label>
                                                    <input type="checkbox" name="example_checkbox">
                                                </label>
                                            </div>ได้แจ้งผลการประเมินเมื่อวันที่.................................................
                                            <div style=" padding-left: 35px; ">แต่ผู้รับการประเมินไม่ลงนามรับทราบผลการประเมิน
                                            </div>
                                            <div style=" padding-left: 35px; padding-top:10px;">โดยมี.......................................................................เป็นพยาน
                                            </div>
                                        </td>
                                            <td>วันที่..........................................................</td>
                                        </tr>
                                    </table>
                                </div>
                                <div>
                                    <h2>ส่วนที่ 6 ความเห็นของผู้บังคับบัญชาเหนือขึ้นไป</h2>
                                    <table class="form-table">
                                        <tr>
                                            <td colspan="2"><strong>ผู้บังคับบัญชาเหนือขึ้นไป :</strong></td>
                                        </tr>
                                        <tr>
                                            <td><div style=" solid black; padding: 10px; display: inline-block;">
                                                <label>
                                                    <input type="checkbox" name="example_checkbox">
                                                </label>
                                            </div>เห็นด้วยกับผลการประเมิน</td>
                                            <td>ลงชื่อ..........................................................</td>
                                        </tr>
                                        <tr>
                                            <td rowspan="2" ><div style=" solid black; padding: 10px; display: inline-block;">
                                                <label>
                                                    <input type="checkbox" name="example_checkbox">
                                                </label>
                                            </div>มีความเห็นแตกต่าง ดังนี้
                                            <div style=" padding-left: 35px; ">.........................................................................................................
                                            </div>
                                            <div style=" padding-left: 35px; padding-top:10px;">.........................................................................................................
                                            </div>
                                        </td>
                                            <td>ตำแหน่ง......................................................</td>
                                        </tr>
                                
                                        <tr>
                                            <td>วันที่............................................................</td>
                                        </tr>
                                
                                        <tr>
                                            <td colspan="2"><strong>ผู้บังคับบัญชาเหนือขึ้นไปอีกชั้นหนึ่ง (ถ้ามี) :</strong></td>
                                        </tr>
                                        <tr>
                                            <td><div style=" solid black; padding: 10px; display: inline-block;">
                                                <label>
                                                    <input type="checkbox" name="example_checkbox">
                                                </label>
                                            </div>เห็นด้วยกับผลการประเมิน</td>
                                            <td>ลงชื่อ..........................................................</td>
                                        </tr>
                                        <tr>
                                            <td rowspan="2" ><div style=" solid black; padding: 10px; display: inline-block;">
                                                <label>
                                                    <input type="checkbox" name="example_checkbox">
                                                </label>
                                            </div>มีความเห็นแตกต่าง ดังนี้
                                            <div style=" padding-left: 35px; ">.........................................................................................................
                                            </div>
                                            <div style=" padding-left: 35px; padding-top:10px;">.........................................................................................................
                                            </div>
                                        </td>
                                            <td>ตำแหน่ง......................................................</td>
                                        </tr>
                                
                                        <tr>
                                            <td>วันที่............................................................</td>
                                        </tr>
                                    </table>
                                </div>
                                </div>









    </body>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fieldTotals = {};
            let overallTotal = 0;
    
            // รวมค่า calculated_workload สำหรับแต่ละ field
            document.querySelectorAll('.selection-row').forEach(row => {
                const fieldId = row.getAttribute('data-field-id');
                const calculatedWorkload = parseFloat(row.getAttribute('data-calculated-workload')) || 0;
    
                // สะสมคะแนนรวมในแต่ละ field
                if (!fieldTotals[fieldId]) {
                    fieldTotals[fieldId] = 0;
                }
    
                fieldTotals[fieldId] += calculatedWorkload;
                overallTotal += calculatedWorkload; // สะสมคะแนนรวมทั้งหมด
            });
    
            // แสดงผลรวมในแต่ละ field
            Object.keys(fieldTotals).forEach(fieldId => {
                const totalCell = document.querySelector(`.field-total-row[data-field-id="${fieldId}"] .field-total`);
                if (totalCell) {
                    totalCell.textContent = fieldTotals[fieldId].toFixed(2);
                }
            });
    
            // แสดงคะแนนรวมทั้งหมด
            document.getElementById('overall-total').textContent = overallTotal.toFixed(2);
        });
    </script>


</html>

